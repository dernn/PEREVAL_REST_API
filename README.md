![2024-06-20_235455](https://user-images.githubusercontent.com/108303572/228615897-8bd00bcd-cd95-4a56-9783-34211fdf2780.jpg)

# PEREVAL REST API

## Стажировка ФСТР

Федерации спортивного туризма России [pereval.online](https://pereval.online)
(далее - ФСТР) заказала студентам SkillFactory разработать мобильное приложение для Android и IOS, которое упростило бы
туристам задачу по отправке данных о перевале и сократило время обработки запроса до трёх дней.

ФСТР — организация, занимающаяся развитием и популяризацией спортивного туризма в России и руководящая проведением
всероссийских соревнований в этом виде спорта.

Пользоваться мобильным приложением будут туристы. В горах они будут вносить данные о перевале в приложение и отправлять
их в ФСТР, как только появится доступ в Интернет.

Модератор из федерации будет верифицировать и вносить в базу данных информацию, полученную от пользователей, а те в свою
очередь смогут увидеть в мобильном приложении статус модерации и просматривать базу с объектами, внесёнными другими.

___

Внешние ресурсы:

CJM пользователя. CJM (customer journey map) — это карта, описывающая путь пользователя при взаимодействии с продуктом,
чтобы лучше понимать, как будет работать мобильное приложение. CJM доступна
[по ссылке](https://docs.google.com/spreadsheets/d/1eNFtPqYUFftQ4v-OC2K91rDGwBfUhsLh3UvEY1CXov0/edit?gid=0#gid=0).

UX/UI [прототип](https://www.figma.com/proto/tTeEh80nuYQIgbuCJy9dr8/%D0%A4%D0%A1%D0%A2%D0%A0-(Copy)-(Copy)?kind=proto&node-id=598-34467&page-id=61%3A2&scaling=scale-down&show-proto-sidebar=1&starting-point-node-id=570%3A2127)
интерфейса в Figma.

Сейчас ФСТР использует [вот такую](https://drive.google.com/file/d/1TuFcH5k-lU21b6xQtCeQ_UTW8OJwR9f3/view) структуру
базы данных. Внимательно изучи её. Тебе нужно её немного доработать.

___

*Турист с помощью мобильного приложения будет передавать в ФСТР следующие данные о перевале:*

+ ***Информацию о себе:***
    + ***Фамилия;***
    + ***Имя;***
    + ***Отчество;***
    + ***Электронная почта;***
    + ***Номер телефона.***
+ ***Название объекта;***
+ ***Координаты объекта и его высоту;***
+ ***Уровень сложности в зависимости от времени года;***
+ ***Несколько фотографий.***

*После этого турист нажимает кнопку **«Отправить»** в мобильном приложении. Мобильное приложение вызовет метод **
submitData**.*


> _**POST**_ `/submitData/` — принимает _JSON_ в теле запроса с информацией
> о перевале. Пример _JSON-а_:

```
{
  "beauty_title": "пер. ",
  "title": "Пхия",
  "other_titles": "Триев",
  "connect": "", // что соединяет, текстовое поле
 
  "add_time": "2021-09-22 13:18:13",
  "user": {"email": "qwerty@mail.ru",
           "fam": "Пупкин",
           "name": "Василий",
           "otc": "Иванович",
           "phone": "+7 555 55 55"}, 
 
  "coords":{"latitude": "45.3842",
            "longitude": "7.1525",
            "height": "1200"}
  
  level:{"winter": "", // Категория трудности. В разное время года перевал может иметь разную категорию трудности
         "summer": "1А",
         "autumn": "1А",
         "spring": ""},
 
   images: [{data:"<картинка1>", title:"Седловина"},
            {data:"<картинка>", title:"Подъём"}]
}
```

***Результат метода:** JSON*

+ ***status*** — код _HTTP_, целое число:
    - 500 — ошибка при выполнении операции;
    - 400 *— Bad Request (при нехватке полей);*
    - 200 — успех.
+ ***message*** — строка:
    - Причина ошибки *(если она была);*
    - _None_ в случае успеха.
+ _**id**_ — _{serializer.data}_, весь набор полей как в примере выше _(если отправка прошла успешно)_.

***Примеры ответов:***

`{ "status": 500, "message": "Internal Server Error","id": null}`

`{ "status": 200, "message": null, "id": {serializer.data} }`

После того как турист добавит в базу данных информацию о новом перевале, сотрудники ФСТР проведут модерацию для каждого
нового объекта и поменяют поле _status_.

Допустимые значения поля _**status**_:

+ *'new';*
+ *'pending'* — модератор взял в работу;
+ *'accepted'* — модерация прошла успешно;
+ *'rejected'* — модерация прошла, информация отклонена.

___

> **_Другие методы:_**

* **_GET `/submitData/<id>`_** — получает одну запись (перевал) по её id. Выводит всю информацию об объекте, в том числе
  статус модерации.
* **_PATCH `/submitData/<id>`_** — редактирование существующей записи _(partial_update)_, если она в статусе _'new'_.
  Редактировать можно все поля, кроме _данных пользователя, статуса модерации и времени создания записи_. Метод
  принимает тот же самый JSON, что и метод _submitData_.
  <br><br>
  В качестве результата метод **_PATCH_** возвращает два значения:
    * _**state**_:
        * 1 — если успешно удалось отредактировать запись;
        * 0 — в противном случае.
    * _**message**_ — сообщение, если обновить запись не удалось.


* **_GET `/submitData/?user__email=<email>`_** — список данных обо всех объектах, которые пользователь с
  почтой `<email>` отправил на сервер.

___

Проект на **pythonanywhere.com**:

> https://dernn.pythonanywhere.com/api/

___

_* документация сгенерирована с помощью пакета_ `drf-spectacular`:

* **Swagger**: https://dernn.pythonanywhere.com/api/swagger-ui/
* **Redoc**: https://dernn.pythonanywhere.com/api/redoc/

___

_** код покрыт тестами на 80%_

